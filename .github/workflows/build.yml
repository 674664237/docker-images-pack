name: Package Docker Images

on:
  workflow_dispatch:

jobs:
  package:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Configure Docker mirror
        run: |
          sudo mkdir -p /etc/docker
          echo '{"registry-mirrors": ["https://docker.daocloud.io"]}' | sudo tee /etc/docker/daemon.json
          sudo systemctl restart docker
          sleep 5

      - name: Pull images
        run: |
          docker pull nginx:alpine
          docker pull alpine
          docker images

      - name: Save to tar
        run: |
          docker save nginx:alpine alpine -o images.tar
          ls -lh images.tar
          if [ ! -s images.tar ]; then
            echo "‚ùå Error: images.tar is empty!"
            exit 1
          fi

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: images.tar
          tag_name: v1.0
          name: v1.0
